<!DOCTYPE html>
<html>


<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- 可选的 Bootstrap 主题文件（一般不用引入） -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap-theme.min.css"
          integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">


    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>


    <title></title>
</head>

<body>


<div class="container" style="width:60%;">
    <div class="jumbotron">
        <h1>一个算IBNR的网站</h1>
    </div>


    <div class="row">
        <div class="col-md-4">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h2 class="panel-title">
                        上传理赔文件
                    </h2>
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-8">
                            <form enctype="multipart/form-data" method="post" name="upload">
                                <input type="file" id="file" required/>
                            </form>
                        </div>
                        <div class="col-md-4">
                            <button id="btn_upload">上传</button>
                        </div>

                    </div>
                </div>
            </div>

            <div class="panel panel-default">
                <div class="panel-heading">
                    <h2 class="panel-title">
                        文件信息
                    </h2>
                </div>
                <div class="panel-body">
                    <h3>行数</h3>
                    <p id="rownum"></p>
                    <h3>列数</h3>
                    <p id="colnum"></p>
                    <h3>最早出险月</h3>
                    <p id="datemin"></p>
                    <h3>最晚出险月</h3>
                    <p id="datemax"></p>
                    <h3>保单年</h3>
                    <table class="table table-condensed">
                        <thead>
                        <tr>
                            <th>保单年</th>
                            <th>记录数</th>
                        </tr>
                        </thead>
                        <tbody id='cntr_year_table'>
                        </tbody>
                    </table>


                </div>


            </div>


        </div>

        <div class="col-md-8">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h2 class="panel-title">
                        预览
                    </h2>
                </div>
                <div class="panel-body">
                    <table class="table table-condensed">
                        <thead>
                        <tr>
                            <th>occur_month</th>
                            <th>acc_close</th>
                            <th>cntr_year</th>
                            <th>pay_amnt</th>
                        </tr>
                        </thead>
                        <tbody id='head_table'>

                        </tbody>
                    </table>
                </div>


            </div>
        </div>
    </div>
</div>


<div class="container" style="width:60%;">
    <div class="jumbotron">
        <h1>CAL</h1>
    </div>
    <div class="row">
        <div class="col-md-4">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h2 class="panel-title">
                        基本设置
                    </h2>
                </div>
                <div class="panel-body">
                    <div class="input-group">
                        <span class="input-group-addon" >起始月（YYYY年MM月）</span>
                        <input type="text" class="form-control" id="date_start" aria-describedby="basic-addon3">
                    </div>
                    <br>
                    <div class="input-group">
                        <span class="input-group-addon" >终止月（YYYY年MM月）</span>
                        <input type="text" class="form-control" id="date_end" aria-describedby="basic-addon3">
                    </div>
<br>
                    <button id="btn_cal1">计算件数三角形</button>
                </div>


            </div>



        </div>

        <div class="col-md-8">



        </div>



    </div>


</div>


</body>


<script>
    $('#btn_upload').click(function () {
        var data = document.upload.file.files[0];
        var fm = new FormData();
        fm.append('data', data);
        $.ajax(
            {
                url: '/upload',
                type: 'POST',
                dataType: 'json',
                data: fm,
                contentType: false,
                processData: false
            }
        ).done(function (res) {

            var str = "";
            var head_table = res['head_table'];
            $.each(head_table, function (index, element) {
                str += "<tr><td>" + element['occur_month']
                    + "</td><td>" + element['acc_close']
                    + "</td><td>" + element['cntr_year']
                    + "</td><td>" + element['pay_amnt']
                    + "</td></tr>";
            });

            $('#head_table').empty().append(str);
            $('#rownum').text(res['shapey']);
            $('#colnum').text(res['shapex']);
            $('#datemin').text(res['datemin']);
            $('#datemax').text(res['datemax']);
            $('#date_start').val(res['datemin']);
            $('#date_end').val(res['datemax']);

            var cntr_year_table_str = "";
            var cntr_year_table = res['cntr_years'];
            $.each(cntr_year_table, function (index, element) {
                cntr_year_table_str += "<tr><td>" + element['cntr_year']
                    + "</td><td>" + element['counts']
                    + "</td></tr>";
            });
            $('#cntr_year_table').empty().append(cntr_year_table_str);


        }).fail(function (res) {
            alert("error!");
        });
    });

    $('#btn_cal1').click(function () {
        var filename=document.upload.file.files[0].name;
        var date_start= $('#date_start').val();
        var date_end=$('#date_end').val();
        console.log({'filename':filename,'date_start':date_start,'date_end':date_end});
        $.ajax(
            {
                url: '/caltri',
                type: 'POST',
                dataType: 'json',
                contentType : "application/json",
                data:{'filename':filename,'date_start':date_start,'date_end':date_end},
                contentType: false,
                processData: false
            }
        )

    });




</script>


</html>